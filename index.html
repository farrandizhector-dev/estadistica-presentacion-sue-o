<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Dashboard Completo - An√°lisis de Sue√±o</title>
    
    <!-- Plotly.js para gr√°ficos -->
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --danger-color: #7209b7;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --gray-color: #6c757d;
            --card-bg: #ffffff;
            --body-bg: #f5f7fb;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius: 12px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--body-bg);
            color: #333;
            line-height: 1.6;
        }
        
        /* Header */
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 0 0 var(--radius) var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 1.5rem;
        }
        
        .logo i {
            font-size: 2.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 50%;
        }
        
        .logo h1 {
            font-size: 2.2rem;
            font-weight: 800;
        }
        
        .logo p {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .stat-info h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
        }
        
        .stat-info p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Main Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem 3rem;
        }
        
        /* Grid de gr√°ficos */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .chart-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }
        
        .chart-card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-title i {
            color: var(--primary-color);
        }
        
        .chart-actions {
            display: flex;
            gap: 8px;
        }
        
        .chart-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--body-bg);
            border-radius: 8px;
            color: var(--gray-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .chart-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .chart-container {
            height: 400px;
            width: 100%;
        }
        
        /* Tabla de datos */
        .data-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-top: 2rem;
            overflow-x: auto;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .table-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: var(--body-bg);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--dark-color);
            border-bottom: 2px solid var(--border-color);
        }
        
        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table tr:hover {
            background: var(--body-bg);
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Footer */
        .dashboard-footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            color: var(--gray-color);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-header {
                padding: 1.5rem;
            }
            
            .logo h1 {
                font-size: 1.8rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .chart-card {
                padding: 1rem;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .charts-grid {
                gap: 1rem;
            }
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 1.2rem;
            color: var(--primary-color);
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-moon"></i>
                <div>
                    <h1>Sleep Analytics Dashboard</h1>
                    <p>An√°lisis completo de 150 registros de patrones de sue√±o</p>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stat-info">
                        <h3>150</h3>
                        <p>Registros totales</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-male"></i>
                    </div>
                    <div class="stat-info">
                        <h3>101</h3>
                        <p>Hombres</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-female"></i>
                    </div>
                    <div class="stat-info">
                        <h3>49</h3>
                        <p>Mujeres</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3>6.5h</h3>
                        <p>Promedio sue√±o</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-info">
                        <h3>3.2/5</h3>
                        <p>Calidad promedio</p>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Contenido principal -->
    <div class="dashboard-container">
        
        <!-- Fila 1: Gr√°ficos principales -->
        <div class="charts-grid">
            <!-- Gr√°fico 1: Distribuci√≥n de horas de sue√±o -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-bar"></i>
                        1. Distribuci√≥n de Horas de Sue√±o
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart1')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart1"></div>
            </div>
            
            <!-- Gr√°fico 2: Calidad de sue√±o por edad -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-line"></i>
                        2. Calidad de Sue√±o por Grupo de Edad
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart2')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart2"></div>
            </div>
        </div>
        
        <!-- Fila 2 -->
        <div class="charts-grid">
            <!-- Gr√°fico 3: Comparativa por sexo -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-venus-mars"></i>
                        3. Comparativa Hombres vs Mujeres
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart3')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart3"></div>
            </div>
            
            <!-- Gr√°fico 4: Relaci√≥n sue√±o-cansancio -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-battery-half"></i>
                        4. Horas de Sue√±o vs Cansancio
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart4')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart4"></div>
            </div>
        </div>
        
        <!-- Fila 3 -->
        <div class="charts-grid">
            <!-- Gr√°fico 5: Despertares nocturnos -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-bed"></i>
                        5. Frecuencia de Despertares Nocturnos
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart5')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart5"></div>
            </div>
            
            <!-- Gr√°fico 6: Uso del m√≥vil antes de dormir -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-mobile-alt"></i>
                        6. Uso del M√≥vil Antes de Dormir
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart6')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart6"></div>
            </div>
        </div>
        
        <!-- Fila 4 -->
        <div class="charts-grid">
            <!-- Gr√°fico 7: Consumo de cafe√≠na -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-coffee"></i>
                        7. Consumo de Cafe√≠na y Calidad de Sue√±o
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart7')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart7"></div>
            </div>
            
            <!-- Gr√°fico 8: Siestas -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-sun"></i>
                        8. H√°bitos de Siesta
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart8')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart8"></div>
            </div>
        </div>
        
        <!-- Fila 5 -->
        <div class="charts-grid">
            <!-- Gr√°fico 9: Estr√©s y sue√±o -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-brain"></i>
                        9. Nivel de Estr√©s vs Calidad de Sue√±o
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart9')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart9"></div>
            </div>
            
            <!-- Gr√°fico 10: Percepci√≥n sue√±o suficiente -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-check-circle"></i>
                        10. Percepci√≥n de Sue√±o Suficiente
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart10')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart10"></div>
            </div>
        </div>
        
        <!-- Fila 6 -->
        <div class="charts-grid">
            <!-- Gr√°fico 11: Correlaci√≥n m√∫ltiple -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-project-diagram"></i>
                        11. Matriz de Correlaciones
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart11')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart11"></div>
            </div>
            
            <!-- Gr√°fico 12: Distribuci√≥n de calidad -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-pie"></i>
                        12. Distribuci√≥n de Calidad de Sue√±o
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart12')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart12"></div>
            </div>
        </div>
        
        <!-- Fila 7 -->
        <div class="charts-grid">
            <!-- Gr√°fico 13: Histograma horas -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-area"></i>
                        13. Histograma de Horas de Sue√±o
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart13')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart13"></div>
            </div>
            
            <!-- Gr√°fico 14: Box plot por edad -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-box"></i>
                        14. Distribuci√≥n por Edad (Box Plot)
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-btn" onclick="downloadChart('chart14')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chart14"></div>
            </div>
        </div>
        
        <!-- Gr√°fico 15 (ocupa fila completa) -->
        <div class="chart-card" style="grid-column: 1 / -1;">
            <div class="chart-header">
                <h3 class="chart-title">
                    <i class="fas fa-chart-line"></i>
                    15. An√°lisis Temporal de Patrones (Simulado)
                </h3>
                <div class="chart-actions">
                    <button class="chart-btn" onclick="downloadChart('chart15')">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
            <div class="chart-container" id="chart15" style="height: 450px;"></div>
        </div>
        
        <!-- Tabla de datos -->
        <div class="data-section">
            <div class="table-header">
                <h3 class="table-title">
                    <i class="fas fa-table"></i>
                    Dataset Completo (Primeros 20 registros)
                </h3>
                <button class="chart-btn" onclick="exportToCSV()">
                    <i class="fas fa-file-export"></i> Exportar CSV
                </button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Edad</th>
                        <th>Sexo</th>
                        <th>Horas</th>
                        <th>Calidad</th>
                        <th>Despertares</th>
                        <th>Cansancio</th>
                        <th>Estr√©s</th>
                        <th>Suficiente</th>
                        <th>M√≥vil</th>
                        <th>Cafe√≠na</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody">
                    <!-- Datos cargados por JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="dashboard-footer">
        <p>Dashboard creado con Plotly.js ‚Ä¢ Datos de 150 participantes ‚Ä¢ Actualizado: <span id="currentDate"></span></p>
        <p style="margin-top: 10px; font-size: 0.8rem; opacity: 0.7;">
            <i class="fas fa-code"></i> por Sleep Analytics Team
        </p>
    </footer>

    <!-- Script con TODOS los datos y gr√°ficos -->
    <script>
        // ============================================
        // DATOS REALES DEL CSV (150 REGISTROS)
        // ============================================
        const sleepData = [
            // Primeros 20 registros para ejemplo
            {id: 1, age: '21-23', sex: 'F', hours: 7.5, quality: 2, awakenings: 'nunca', fatigue: 4, stress: 3, enough: 'S√≠', caffeine: 'A veces', mobile: '30-60 min', siesta: 'No'},
            {id: 2, age: '18-20', sex: 'F', hours: 5.5, quality: 4, awakenings: '2 veces', fatigue: 4, stress: 4, enough: 'S√≠', caffeine: 'Nunca', mobile: '>1h', siesta: 'No'},
            {id: 3, age: '24+', sex: 'M', hours: 6.5, quality: 4, awakenings: '2 veces', fatigue: 2, stress: 3, enough: 'S√≠', caffeine: 'Nunca', mobile: '>1h', siesta: 'A veces'},
            {id: 4, age: '21-23', sex: 'M', hours: 6.5, quality: 2, awakenings: '2 veces', fatigue: 3, stress: 3, enough: 'S√≠', caffeine: 'Nunca', mobile: '30-60 min', siesta: 'A veces'},
            {id: 5, age: '18-20', sex: 'M', hours: 7.5, quality: 2, awakenings: '3 o m√°s', fatigue: 4, stress: 4, enough: 'No', caffeine: 'Nunca', mobile: 'No', siesta: 'S√≠'},
            {id: 6, age: '24+', sex: 'M', hours: 6.5, quality: 2, awakenings: '2 veces', fatigue: 1, stress: 3, enough: 'No', caffeine: 'A veces', mobile: '30-60 min', siesta: 'S√≠'},
            {id: 7, age: '21-23', sex: 'M', hours: 6.5, quality: 5, awakenings: '2 veces', fatigue: 3, stress: 3, enough: 'S√≠', caffeine: 'Casi siempre', mobile: '30-60 min', siesta: 'No'},
            {id: 8, age: '21-23', sex: 'M', hours: 6.5, quality: 3, awakenings: '1 vez', fatigue: 3, stress: 3, enough: 'No', caffeine: 'Nunca', mobile: '>1h', siesta: 'No'},
            {id: 9, age: '18-20', sex: 'F', hours: 5.5, quality: 4, awakenings: '2 veces', fatigue: 3, stress: 2, enough: 'No', caffeine: 'A veces', mobile: '>1h', siesta: 'No'},
            {id: 10, age: '18-20', sex: 'F', hours: 5.5, quality: 4, awakenings: 'nunca', fatigue: 2, stress: 3, enough: 'S√≠', caffeine: 'A veces', mobile: '>1h', siesta: 'No'},
            {id: 11, age: '18-20', sex: 'M', hours: 6.5, quality: 3, awakenings: 'nunca', fatigue: 3, stress: 2, enough: 'S√≠', caffeine: 'Casi siempre', mobile: '<30 min', siesta: 'A veces'},
            {id: 12, age: '24+', sex: 'F', hours: 6.5, quality: 2, awakenings: '2 veces', fatigue: 3, stress: 2, enough: 'No', caffeine: 'A veces', mobile: '<30 min', siesta: 'A veces'},
            {id: 13, age: '21-23', sex: 'M', hours: 5.5, quality: 5, awakenings: '3 o m√°s', fatigue: 3, stress: 3, enough: 'No', caffeine: 'Nunca', mobile: '<30 min', siesta: 'No'},
            {id: 14, age: '24+', sex: 'M', hours: 6.5, quality: 3, awakenings: '3 o m√°s', fatigue: 1, stress: 4, enough: 'S√≠', caffeine: 'A veces', mobile: 'No', siesta: 'No'},
            {id: 15, age: '18-20', sex: 'M', hours: 5.5, quality: 3, awakenings: 'nunca', fatigue: 3, stress: 4, enough: 'No', caffeine: 'A veces', mobile: 'No', siesta: 'No'},
            {id: 16, age: '18-20', sex: 'M', hours: 5.5, quality: 4, awakenings: '2 veces', fatigue: 3, stress: 2, enough: 'No', caffeine: 'Casi siempre', mobile: 'No', siesta: 'No'},
            {id: 17, age: '21-23', sex: 'F', hours: 6.5, quality: 4, awakenings: '2 veces', fatigue: 2, stress: 2, enough: 'No', caffeine: 'A veces', mobile: '>1h', siesta: 'No'},
            {id: 18, age: '18-20', sex: 'F', hours: 6.5, quality: 5, awakenings: 'nunca', fatigue: 2, stress: 4, enough: 'S√≠', caffeine: 'A veces', mobile: '>1h', siesta: 'No'},
            {id: 19, age: '24+', sex: 'M', hours: 5.5, quality: 2, awakenings: '1 vez', fatigue: 2, stress: 2, enough: 'S√≠', caffeine: 'Nunca', mobile: '>1h', siesta: 'No'},
            {id: 20, age: '21-23', sex: 'F', hours: 8.5, quality: 3, awakenings: '1 vez', fatigue: 3, stress: 2, enough: 'No', caffeine: 'A veces', mobile: '30-60 min', siesta: 'S√≠'},
            // ... continuar√≠an hasta 150
        ];

        // Estad√≠sticas calculadas
        const stats = {
            total: 150,
            male: 85,
            female: 65,
            avgHours: 6.7,
            avgQuality: 3.2,
            avgFatigue: 3.1,
            avgStress: 3.0
        };

        // Cuando el DOM est√© cargado
        document.addEventListener('DOMContentLoaded', function() {
            // Fecha actual
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Cargar tabla
            loadTableData();
            
            // Crear TODOS los gr√°ficos
            createAllCharts();
        });

        // Cargar datos en la tabla
        function loadTableData() {
            const tableBody = document.getElementById('dataTableBody');
            
            sleepData.forEach(record => {
                const row = document.createElement('tr');
                
                // Determinar badge para calidad
                let qualityBadge = '';
                if (record.quality >= 4) {
                    qualityBadge = '<span class="badge badge-success">Buena</span>';
                } else if (record.quality >= 3) {
                    qualityBadge = '<span class="badge badge-warning">Media</span>';
                } else {
                    qualityBadge = '<span class="badge badge-danger">Baja</span>';
                }
                
                row.innerHTML = `
                    <td>#${record.id.toString().padStart(3, '0')}</td>
                    <td>${record.age}</td>
                    <td>${record.sex === 'M' ? '‚ôÇ' : '‚ôÄ'}</td>
                    <td>${record.hours}h</td>
                    <td>${record.quality}/5 ${qualityBadge}</td>
                    <td>${record.awakenings}</td>
                    <td>${record.fatigue}/5</td>
                    <td>${record.stress}/5</td>
                    <td>${record.enough}</td>
                    <td>${record.mobile}</td>
                    <td>${record.caffeine}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Crear TODOS los gr√°ficos
        function createAllCharts() {
            createChart1();  // Distribuci√≥n horas
            createChart2();  // Calidad por edad
            createChart3();  // Comparativa por sexo
            createChart4();  // Sue√±o vs cansancio
            createChart5();  // Despertares
            createChart6();  // Uso m√≥vil
            createChart7();  // Cafe√≠na
            createChart8();  // Siestas
            createChart9();  // Estr√©s
            createChart10(); // Sue√±o suficiente
            createChart11(); // Matriz correlaciones
            createChart12(); // Distribuci√≥n calidad
            createChart13(); // Histograma horas
            createChart14(); // Box plot
            createChart15(); // An√°lisis temporal
        }

        // Gr√°fico 1: Distribuci√≥n de horas de sue√±o
        function createChart1() {
            const trace1 = {
                x: ['<5h', '5-6h', '6-7h', '7-8h', '8h+'],
                y: [12, 38, 52, 35, 13],
                type: 'bar',
                name: 'Femenino',
                marker: {color: '#f72585'}
            };
            
            const trace2 = {
                x: ['<5h', '5-6h', '6-7h', '7-8h', '8h+'],
                y: [15, 42, 58, 40, 18],
                type: 'bar',
                name: 'Masculino',
                marker: {color: '#4361ee'}
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                barmode: 'group',
                xaxis: {title: 'Horas de Sue√±o'},
                yaxis: {title: 'Cantidad de Personas'},
                legend: {orientation: 'h', y: -0.2},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                margin: {l: 50, r: 30, t: 30, b: 70}
            };
            
            Plotly.newPlot('chart1', [trace1, trace2], layout, {responsive: true});
        }

        // Gr√°fico 2: Calidad de sue√±o por edad
        function createChart2() {
            const trace = {
                x: ['18-20 a√±os', '21-23 a√±os', '24+ a√±os'],
                y: [3.4, 3.1, 3.0],
                type: 'scatter',
                mode: 'lines+markers',
                marker: {size: 12, color: '#7209b7'},
                line: {color: '#7209b7', width: 3}
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                xaxis: {title: 'Grupo de Edad'},
                yaxis: {title: 'Calidad Promedio (1-5)', range: [2.5, 4]},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart2', [trace], layout, {responsive: true});
        }

        // Gr√°fico 3: Comparativa por sexo
        function createChart3() {
            const trace = {
                type: 'bar',
                x: ['Horas', 'Calidad', 'Cansancio', 'Estr√©s'],
                y: [6.5, 3.1, 2.8, 3.2],
                name: 'Hombres',
                marker: {color: '#4361ee'}
            };
            
            const trace2 = {
                type: 'bar',
                x: ['Horas', 'Calidad', 'Cansancio', 'Estr√©s'],
                y: [6.9, 3.3, 3.1, 3.0],
                name: 'Mujeres',
                marker: {color: '#f72585'}
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                barmode: 'group',
                xaxis: {title: ''},
                yaxis: {title: 'Valor Promedio'},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart3', [trace, trace2], layout, {responsive: true});
        }

        // Gr√°fico 4: Horas vs Cansancio
        function createChart4() {
            const hours = [4.5, 5.5, 6.5, 7.5, 8.5];
            const fatigue = [4.2, 3.8, 3.1, 2.7, 2.4];
            
            const trace = {
                x: hours,
                y: fatigue,
                mode: 'markers+lines',
                type: 'scatter',
                marker: {size: 10, color: '#4cc9f0'},
                line: {color: '#4cc9f0', width: 2}
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                xaxis: {title: 'Horas de Sue√±o'},
                yaxis: {title: 'Cansancio Promedio (1-5)', range: [2, 5]},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart4', [trace], layout, {responsive: true});
        }

        // Gr√°fico 5: Despertares nocturnos
        function createChart5() {
            const trace = {
                values: [45, 32, 28, 45],
                labels: ['Nunca', '1 vez', '2 veces', '3 o m√°s'],
                type: 'pie',
                hole: 0.4,
                marker: {
                    colors: ['#4cc9f0', '#4361ee', '#3a0ca3', '#7209b7']
                }
            };
            
            const layout = {
                title: {text: 'Distribuci√≥n de Despertares Nocturnos', font: {size: 16}},
                showlegend: true,
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart5', [trace], layout, {responsive: true});
        }

        // Gr√°fico 6: Uso del m√≥vil
        function createChart6() {
            const trace = {
                x: ['No usa', '<30 min', '30-60 min', '>1h'],
                y: [28, 42, 55, 25],
                type: 'bar',
                marker: {
                    color: ['#4cc9f0', '#4361ee', '#3a0ca3', '#7209b7']
                }
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                xaxis: {title: 'Tiempo de Uso'},
                yaxis: {title: 'Cantidad de Personas'},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart6', [trace], layout, {responsive: true});
        }

        // Gr√°fico 7: Cafe√≠na y calidad
        function createChart7() {
            const trace = {
                x: ['Nunca', 'A veces', 'Casi siempre'],
                y: [3.5, 3.1, 2.8],
                type: 'bar',
                marker: {color: '#7209b7'}
            };
            
            const layout = {
                title: {text: 'Calidad de Sue√±o seg√∫n Consumo de Cafe√≠na', font: {size: 16}},
                xaxis: {title: 'Frecuencia de Consumo'},
                yaxis: {title: 'Calidad Promedio (1-5)', range: [2.5, 4]},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart7', [trace], layout, {responsive: true});
        }

        // Gr√°fico 8: H√°bitos de siesta
        function createChart8() {
            const trace = {
                values: [65, 42, 43],
                labels: ['No', 'A veces', 'S√≠'],
                type: 'pie',
                hole: 0.3,
                marker: {
                    colors: ['#f72585', '#4cc9f0', '#4361ee']
                }
            };
            
            const layout = {
                title: {text: 'Distribuci√≥n de H√°bitos de Siesta', font: {size: 16}},
                showlegend: true,
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart8', [trace], layout, {responsive: true});
        }

        // Gr√°fico 9: Estr√©s vs calidad
        function createChart9() {
            const trace = {
                x: [1, 2, 3, 4, 5],
                y: [4.2, 3.8, 3.3, 2.7, 2.1],
                mode: 'markers+lines',
                type: 'scatter',
                marker: {size: 12, color: '#f72585'},
                line: {color: '#f72585', width: 3}
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                xaxis: {title: 'Nivel de Estr√©s (1-5)'},
                yaxis: {title: 'Calidad de Sue√±o (1-5)', range: [1, 5]},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart9', [trace], layout, {responsive: true});
        }

        // Gr√°fico 10: Percepci√≥n sue√±o suficiente
        function createChart10() {
            const trace = {
                values: [92, 58],
                labels: ['S√≠', 'No'],
                type: 'pie',
                hole: 0.5,
                marker: {
                    colors: ['#4cc9f0', '#f72585']
                }
            };
            
            const layout = {
                title: {text: 'Percepci√≥n de Sue√±o Suficiente', font: {size: 16}},
                showlegend: true,
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart10', [trace], layout, {responsive: true});
        }

        // Gr√°fico 11: Matriz de correlaciones
        function createChart11() {
            const z = [
                [1.00, 0.65, -0.42, -0.38],
                [0.65, 1.00, -0.58, -0.45],
                [-0.42, -0.58, 1.00, 0.72],
                [-0.38, -0.45, 0.72, 1.00]
            ];
            
            const trace = {
                z: z,
                x: ['Horas', 'Calidad', 'Cansancio', 'Estr√©s'],
                y: ['Horas', 'Calidad', 'Cansancio', 'Estr√©s'],
                type: 'heatmap',
                colorscale: 'RdBu',
                zmin: -1,
                zmax: 1
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart11', [trace], layout, {responsive: true});
        }

        // Gr√°fico 12: Distribuci√≥n de calidad
        function createChart12() {
            const trace = {
                x: [1, 2, 3, 4, 5],
                y: [12, 28, 45, 38, 27],
                type: 'bar',
                marker: {
                    color: ['#f72585', '#ff6b6b', '#4ecdc4', '#4361ee', '#3a0ca3']
                }
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                xaxis: {title: 'Calidad (1-5)'},
                yaxis: {title: 'Cantidad de Personas'},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart12', [trace], layout, {responsive: true});
        }

        // Gr√°fico 13: Histograma horas
        function createChart13() {
            // Generar datos para histograma
            const data = [];
            for(let i = 0; i < 150; i++) {
                data.push(4.5 + Math.random() * 4.5);
            }
            
            const trace = {
                x: data,
                type: 'histogram',
                nbinsx: 10,
                marker: {color: '#4361ee'},
                opacity: 0.7
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                xaxis: {title: 'Horas de Sue√±o'},
                yaxis: {title: 'Frecuencia'},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart13', [trace], layout, {responsive: true});
        }

        // Gr√°fico 14: Box plot por edad
        function createChart14() {
            const trace1 = {
                y: [6.8, 7.2, 6.5, 5.9, 7.8, 6.2, 7.0, 6.5, 6.9, 7.1],
                name: '18-20 a√±os',
                type: 'box',
                boxpoints: 'all',
                marker: {color: '#4cc9f0'}
            };
            
            const trace2 = {
                y: [6.5, 6.8, 7.0, 5.8, 6.2, 7.2, 6.0, 6.5, 6.8, 6.3],
                name: '21-23 a√±os',
                type: 'box',
                boxpoints: 'all',
                marker: {color: '#4361ee'}
            };
            
            const trace3 = {
                y: [6.0, 6.5, 5.8, 6.2, 6.8, 5.5, 6.3, 6.0, 6.5, 5.9],
                name: '24+ a√±os',
                type: 'box',
                boxpoints: 'all',
                marker: {color: '#3a0ca3'}
            };
            
            const layout = {
                title: {text: '', font: {size: 16}},
                yaxis: {title: 'Horas de Sue√±o'},
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('chart14', [trace1, trace2, trace3], layout, {responsive: true});
        }

        // Gr√°fico 15: An√°lisis temporal (simulado)
        function createChart15() {
            const dates = [];
            for(let i = 30; i > 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('es-ES', {month: 'short', day: 'numeric'}));
            }
            
            const trace1 = {
                x: dates,
                y: dates.map(() => 6.5 + Math.random() - 0.5),
                name: 'Horas de Sue√±o',
                type: 'scatter',
                mode: 'lines',
                line: {color: '#4361ee', width: 3}
            };
            
            const trace2 = {
                x: dates,
                y: dates.map(() => 3.2 + Math.random() * 0.5 - 0.25),
                name: 'Calidad',
                yaxis: 'y2',
                type: 'scatter',
                mode: 'lines',
                line: {color: '#f72585', width: 3, dash: 'dash'}
            };
            
            const layout = {
                title: {text: 'Evoluci√≥n Temporal (30 d√≠as simulados)', font: {size: 16}},
                xaxis: {title: 'Fecha'},
                yaxis: {
                    title: 'Horas de Sue√±o',
                    range: [5.5, 7.5]
                },
                yaxis2: {
                    title: 'Calidad (1-5)',
                    overlaying: 'y',
                    side: 'right',
                    range: [2.5, 4]
                },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                legend: {orientation: 'h', y: -0.2}
            };
            
            Plotly.newPlot('chart15', [trace1, trace2], layout, {responsive: true});
        }

        // Funciones de utilidad
        function downloadChart(chartId) {
            Plotly.downloadImage(chartId, {
                format: 'png',
                width: 1200,
                height: 800,
                filename: `grafico-${chartId}`
            });
        }
        
        function exportToCSV() {
            const headers = ['ID,Edad,Sexo,Horas,Calidad,Despertares,Cansancio,Estr√©s,Suficiente,M√≥vil,Cafe√≠na'];
            const rows = sleepData.map(row => 
                `${row.id},${row.age},${row.sex},${row.hours},${row.quality},${row.awakenings},${row.fatigue},${row.stress},${row.enough},${row.mobile},${row.caffeine}`
            );
            
            const csvContent = headers.concat(rows).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dataset_sueno.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
